<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ODIL Documentation</title>
<link rel="stylesheet" href="https://stackedit.io/res-min/themes/base.css" />
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body><div class="container"><h1 id="documentation-odil">Documentation Odil</h1>

<p>Hello, this is Odil’s first draft for user documentation. Feel free to comment and suggest enhancements.  <br>
Should you need any definition, you can find them <a href="http://dicom.nema.org/medical/dicom/current/output/chtml/part03/chapter_4.html">here</a> </p>

<p>In this documentation we’ll go through the following concepts. </p>

<ol>
<li><b> How to use, access and browse the dictionary </b></li>
<li><b> Error management:  exceptions vs OFConditions</b></li>
<li><b> Types Odil uses for tags and data in general    </b></li>
<li><b>  How to read/write a file</b></li>
<li><b> Transmit data through the network </b></li>
<li><b>  Different DICOM protocols’ implementations </b></li>
</ol>

<p><div class="toc">
<ul>
<li><a href="#documentation-odil">Documentation Odil</a><ul>
<li><ul>
<li><a href="#1-the-dictionary">1. The dictionary</a></li>
<li><a href="#2-exceptions">2. Exceptions </a></li>
<li><a href="#3-data-types">3. Data types </a></li>
<li><a href="#4-readwrite-data">4. Read/write data </a><ul>
<li><a href="#the-reader-class">The Reader class</a></li>
<li><a href="#the-writer-class">The Writer class</a></li>
<li><a href="#readingwriting-into-a-file">Reading/Writing into a file</a></li>
</ul>
</li>
<li><a href="#5-data-transmission">5. Data transmission</a><ul>
<li><a href="#association-establishment">Association Establishment:</a></li>
<li><a href="#dicom-pdu-protocol-data-units">DICOM PDU (Protocol Data Units)</a></li>
</ul>
</li>
<li><a href="#6-protocols">6. Protocols</a><ul>
<li><a href="#echo">echo</a></li>
<li><a href="#store">store</a></li>
<li><a href="#find">find</a></li>
<li><a href="#get">get</a></li>
<li><a href="#move">move</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</p>



<h3 id="1-the-dictionary"><strong>1. The dictionary</strong></h3>

<p>Odil uses a dictionary to make an associations and store elements.  <br>
This dictionary is actually a map which contains ElementsDictionary. Those ElementsDictionary are a bound type std::map<code>&lt;ElementsDictionaryKey, ElementsDictionaryEntry</code>&gt;. <br>
From the dictionary we can get any element’s Name, Tag, Key, VR( Value Representation ) or VM ( Value Multiplicity). </p>

<p>ElementsDictionaryKey is a class that has 3 types defined in the enum Type inside itself. It can be built from a tag, a string or without any argument, which results in the creation of an ElementsDictionaryKey of type “none”.  </p>

<blockquote>
  <p>As stated in the <a href="http://dicom.nema.org/medical/dicom/current/output/chtml/part06/chapter_3.html">DICOM Documentation</a> , a Tag is : <br>
  “A unique identifier for an element of information composed of an ordered pair of numbers (a Group Number followed by an Element Number), which is used to identify Attributes and corresponding Data Elements.”</p>
</blockquote>

<p>ElementsDictionaryEntry is a struct containing 4 strings: name, keyword, vr (type) and vm (multiplicity) which can all be set into the constructor, and will be assigned to an empty string if they have not been. </p>



<h3 id="2-exceptions"><strong>2. Exceptions </strong></h3>

<p><strong>Unlike DCMTK, Odil does not rely on OFCondition for error handling. </strong></p>

<p>The class odil/Exception inherits from std::exception, and only contains the message passed to the constructor, which is returned whenever the exception is raised. </p>

<p>The Exception class is inherited by several classes, such as AssociationAborted, AssociationRejected and AssociationReleased, which are all related to association negociation</p>

<ul>
<li><strong>AssociationAborted:</strong> contains a source of the error and a reason, with the message set as “Association aborted”. </li>
<li><strong>AssociationRejected:</strong> is a struct which message is set by default to “Association rejected” but can be changed in the constructor, it also contains three private unsigned chars :  _result, _source and _reason.</li>
<li><strong>AssociationReleased:</strong> is just an Exception with its message set as “Association released”. </li>
</ul>



<h3 id="3-data-types"><strong>3. Data types </strong></h3>

<p>Instead of the 31 data types DICOM offers, Odil simplifies it by reducing this number to 5: </p>

<ul>
<li>Integer (int64_t)</li>
<li>Real ( Double ) </li>
<li>String</li>
<li>Binary</li>
<li>DataSets </li>
</ul>

<p>You can find them in the classe Value, which contains the enum containing all Type values and methods to access them.  <br>
<b>NB:  All of them are arrays, even if it is empty or contains only one element!  <br>
    Also, everything is explicitly typed.   </b></p>



<h3 id="4-readwrite-data"><strong>4. Read/write data </strong></h3>

<p>To read and write data, Odil relies mainly on two classes: Reader and Writer. </p>



<h4 id="the-reader-class"><b>The Reader class</b></h4>

<p>This class can read Tags, DataSets, Elements or Files. </p>

<p>To do so, it uses a private Visitor that allows to visit the target data. It is instanciated in function of the type of data we want to read, when it is needed. </p>



<div class="flow-chart"><svg style="overflow: hidden; position: relative; top: -0.100098px;" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="252" version="1.1" height="422"><desc>Created with Raphaël 2.1.2</desc><defs><marker refY="1.5" refX="1.5" orient="auto" markerWidth="3" markerHeight="3" id="raphael-marker-endblock33-obj214"><use stroke="none" fill="black" stroke-width="1.6667" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" xlink:href="#raphael-marker-block"></use></marker><marker refY="1.5" refX="1.5" orient="auto" markerWidth="3" markerHeight="3" id="raphael-marker-endblock33-obj215"><use stroke="none" fill="black" stroke-width="1.6667" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" xlink:href="#raphael-marker-block"></use></marker><marker refY="1.5" refX="1.5" orient="auto" markerWidth="3" markerHeight="3" id="raphael-marker-endblock33-obj216"><use stroke="none" fill="black" stroke-width="1.6667" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" xlink:href="#raphael-marker-block"></use></marker><marker refY="1.5" refX="1.5" orient="auto" markerWidth="3" markerHeight="3" id="raphael-marker-endblock33-obj217"><use stroke="none" fill="black" stroke-width="1.6667" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" xlink:href="#raphael-marker-block"></use></marker></defs><rect transform="matrix(1,0,0,1,74.5,4)" id="st" class="flowchart" stroke-width="2" style="" stroke="#000000" fill="#ffffff" ry="20" rx="20" height="40" width="105" y="0" x="0"></rect><text transform="matrix(1,0,0,1,74.5,4)" font-weight="normal" class="flowchartt" id="stt" fill="#000000" stroke="none" font-size="14px" font-family="sans-serif" text-anchor="start" y="20" x="10" style="text-anchor: start; font-family: sans-serif; font-size: 14px; font-weight: normal;"><tspan dy="5">Reading Data</tspan></text><rect transform="matrix(1,0,0,1,32.5,98)" id="op" class="flowchart" stroke-width="2" style="" stroke="#000000" fill="#ffffff" ry="0" rx="0" height="40" width="189" y="0" x="0"></rect><text transform="matrix(1,0,0,1,32.5,98)" font-weight="normal" class="flowchartt" id="opt" fill="#000000" stroke="none" font-size="14px" font-family="sans-serif" text-anchor="start" y="20" x="10" style="text-anchor: start; font-family: sans-serif; font-size: 14px; font-weight: normal;"><tspan dy="5">Call corresponding method </tspan></text><rect transform="matrix(1,0,0,1,4,192)" id="op2" class="flowchart" stroke-width="2" style="" stroke="#000000" fill="#ffffff" ry="0" rx="0" height="40" width="246" y="0" x="0"></rect><text transform="matrix(1,0,0,1,4,192)" font-weight="normal" class="flowchartt" id="op2t" fill="#000000" stroke="none" font-size="14px" font-family="sans-serif" text-anchor="start" y="20" x="10" style="text-anchor: start; font-family: sans-serif; font-size: 14px; font-weight: normal;"><tspan dy="5">Instanciate Visitor (done by method)</tspan></text><rect transform="matrix(1,0,0,1,53.5,286)" id="op3" class="flowchart" stroke-width="2" style="" stroke="#000000" fill="#ffffff" ry="0" rx="0" height="40" width="147" y="0" x="0"></rect><text transform="matrix(1,0,0,1,53.5,286)" font-weight="normal" class="flowchartt" id="op3t" fill="#000000" stroke="none" font-size="14px" font-family="sans-serif" text-anchor="start" y="20" x="10" style="text-anchor: start; font-family: sans-serif; font-size: 14px; font-weight: normal;"><tspan dy="5">Apply Visitor to Data</tspan><tspan x="10" dy="18"></tspan></text><rect transform="matrix(1,0,0,1,64,380)" id="e" class="flowchart" stroke-width="2" style="" stroke="#000000" fill="#ffffff" ry="20" rx="20" height="40" width="126" y="0" x="0"></rect><text transform="matrix(1,0,0,1,64,380)" font-weight="normal" class="flowchartt" id="et" fill="#000000" stroke="none" font-size="14px" font-family="sans-serif" text-anchor="start" y="20" x="10" style="text-anchor: start; font-family: sans-serif; font-size: 14px; font-weight: normal;"><tspan dy="5">Return read Data</tspan></text><path font-weight="normal" font-family="sans-serif" marker-end="url(#raphael-marker-endblock33-obj214)" stroke-width="2" d="M127,44C127,44,127,83.65409994125366,127,95.00043908460066" stroke="#000000" fill="none" style="font-family: sans-serif; font-weight: normal;"></path><path font-weight="normal" font-family="sans-serif" marker-end="url(#raphael-marker-endblock33-obj215)" stroke-width="2" d="M127,138C127,138,127,177.65409994125366,127,189.00043908460066" stroke="#000000" fill="none" style="font-family: sans-serif; font-weight: normal;"></path><path font-weight="normal" font-family="sans-serif" marker-end="url(#raphael-marker-endblock33-obj216)" stroke-width="2" d="M127,232C127,232,127,271.65409994125366,127,283.00043908460066" stroke="#000000" fill="none" style="font-family: sans-serif; font-weight: normal;"></path><path font-weight="normal" font-family="sans-serif" marker-end="url(#raphael-marker-endblock33-obj217)" stroke-width="2" d="M127,326C127,326,127,365.65409994125366,127,377.00043908460066" stroke="#000000" fill="none" style="font-family: sans-serif; font-weight: normal;"></path></svg></div>



<h4 id="the-writer-class"><b>The Writer class</b></h4>

<p>Using this class, Odil allows you to write the same type of Data the Reader Class allows you to read (DataSets, Tags, Elements or Files). </p>

<p>The writer class proposes two constructors: </p>



<pre class="prettyprint"><code class="language-C++ hljs java">    <span class="hljs-comment">/// @brief Build a writer.</span>
    Writer(
        std::ostream &amp; stream,
        ByteOrdering byte_ordering, bool explicit_vr,
        ItemEncoding item_encoding=ItemEncoding::ExplicitLength,
        bool use_group_length=<span class="hljs-keyword">false</span>);

    <span class="hljs-javadoc">/**
     *<span class="hljs-javadoctag"> @brief</span> Build a writer, derive byte ordering and explicit-ness of VR
     * from transfer syntax.
     */</span>
    Writer(
        std::ostream &amp; stream,
        std::string <span class="hljs-keyword">const</span> &amp; transfer_syntax,
        ItemEncoding item_encoding=ItemEncoding::ExplicitLength,
        bool use_group_length=<span class="hljs-keyword">false</span>);</code></pre>

<p><br><br><br>
The writer’s behaviour can be described by the following flowchart:  <br>
<br></p>



<div class="flow-chart"><svg style="overflow: hidden; position: relative; top: -0.649902px;" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="252" version="1.1" height="422"><desc>Created with Raphaël 2.1.2</desc><defs><marker refY="1.5" refX="1.5" orient="auto" markerWidth="3" markerHeight="3" id="raphael-marker-endblock33-obj228"><use stroke="none" fill="black" stroke-width="1.6667" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" xlink:href="#raphael-marker-block"></use></marker><marker refY="1.5" refX="1.5" orient="auto" markerWidth="3" markerHeight="3" id="raphael-marker-endblock33-obj229"><use stroke="none" fill="black" stroke-width="1.6667" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" xlink:href="#raphael-marker-block"></use></marker><marker refY="1.5" refX="1.5" orient="auto" markerWidth="3" markerHeight="3" id="raphael-marker-endblock33-obj230"><use stroke="none" fill="black" stroke-width="1.6667" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" xlink:href="#raphael-marker-block"></use></marker><marker refY="1.5" refX="1.5" orient="auto" markerWidth="3" markerHeight="3" id="raphael-marker-endblock33-obj231"><use stroke="none" fill="black" stroke-width="1.6667" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" xlink:href="#raphael-marker-block"></use></marker></defs><rect transform="matrix(1,0,0,1,75,4)" id="st" class="flowchart" stroke-width="2" style="" stroke="#000000" fill="#ffffff" ry="20" rx="20" height="40" width="104" y="0" x="0"></rect><text transform="matrix(1,0,0,1,75,4)" font-weight="normal" class="flowchartt" id="stt" fill="#000000" stroke="none" font-size="14px" font-family="sans-serif" text-anchor="start" y="20" x="10" style="text-anchor: start; font-family: sans-serif; font-size: 14px; font-weight: normal;"><tspan dy="5">Select stream</tspan></text><rect transform="matrix(1,0,0,1,32.5,98)" id="op" class="flowchart" stroke-width="2" style="" stroke="#000000" fill="#ffffff" ry="0" rx="0" height="40" width="189" y="0" x="0"></rect><text transform="matrix(1,0,0,1,32.5,98)" font-weight="normal" class="flowchartt" id="opt" fill="#000000" stroke="none" font-size="14px" font-family="sans-serif" text-anchor="start" y="20" x="10" style="text-anchor: start; font-family: sans-serif; font-size: 14px; font-weight: normal;"><tspan dy="5">Call corresponding method </tspan></text><rect transform="matrix(1,0,0,1,4,192)" id="op2" class="flowchart" stroke-width="2" style="" stroke="#000000" fill="#ffffff" ry="0" rx="0" height="40" width="246" y="0" x="0"></rect><text transform="matrix(1,0,0,1,4,192)" font-weight="normal" class="flowchartt" id="op2t" fill="#000000" stroke="none" font-size="14px" font-family="sans-serif" text-anchor="start" y="20" x="10" style="text-anchor: start; font-family: sans-serif; font-size: 14px; font-weight: normal;"><tspan dy="5">Instanciate Visitor (done by method)</tspan></text><rect transform="matrix(1,0,0,1,53.5,286)" id="op3" class="flowchart" stroke-width="2" style="" stroke="#000000" fill="#ffffff" ry="0" rx="0" height="40" width="147" y="0" x="0"></rect><text transform="matrix(1,0,0,1,53.5,286)" font-weight="normal" class="flowchartt" id="op3t" fill="#000000" stroke="none" font-size="14px" font-family="sans-serif" text-anchor="start" y="20" x="10" style="text-anchor: start; font-family: sans-serif; font-size: 14px; font-weight: normal;"><tspan dy="5">Apply Visitor to Data</tspan><tspan x="10" dy="18"></tspan></text><rect transform="matrix(1,0,0,1,63.5,380)" id="e" class="flowchart" stroke-width="2" style="" stroke="#000000" fill="#ffffff" ry="20" rx="20" height="40" width="127" y="0" x="0"></rect><text transform="matrix(1,0,0,1,63.5,380)" font-weight="normal" class="flowchartt" id="et" fill="#000000" stroke="none" font-size="14px" font-family="sans-serif" text-anchor="start" y="20" x="10" style="text-anchor: start; font-family: sans-serif; font-size: 14px; font-weight: normal;"><tspan dy="5">Write into stream</tspan></text><path font-weight="normal" font-family="sans-serif" marker-end="url(#raphael-marker-endblock33-obj228)" stroke-width="2" d="M127,44C127,44,127,83.65409994125366,127,95.00043908460066" stroke="#000000" fill="none" style="font-family: sans-serif; font-weight: normal;"></path><path font-weight="normal" font-family="sans-serif" marker-end="url(#raphael-marker-endblock33-obj229)" stroke-width="2" d="M127,138C127,138,127,177.65409994125366,127,189.00043908460066" stroke="#000000" fill="none" style="font-family: sans-serif; font-weight: normal;"></path><path font-weight="normal" font-family="sans-serif" marker-end="url(#raphael-marker-endblock33-obj230)" stroke-width="2" d="M127,232C127,232,127,271.65409994125366,127,283.00043908460066" stroke="#000000" fill="none" style="font-family: sans-serif; font-weight: normal;"></path><path font-weight="normal" font-family="sans-serif" marker-end="url(#raphael-marker-endblock33-obj231)" stroke-width="2" d="M127,326C127,326,127,365.65409994125366,127,377.00043908460066" stroke="#000000" fill="none" style="font-family: sans-serif; font-weight: normal;"></path></svg></div>



<h4 id="readingwriting-into-a-file">Reading/Writing into a file</h4>

<p>To read/write into a file, you can use the static methods odil::Reader::read_file(std::istream &amp; , bool)  and odil::Writer::write_file(DataSet const &amp;,  std::ostream &amp; )</p>

<p>You can find an example of how to proceed with DICOM directory creation in <a href="https://github.com/lamyj/odil/blob/master/tests/code/BasicDirectoryCreator.cpp#L50">Odil’s tests code</a>. </p>



<h3 id="5-data-transmission"><strong>5. Data transmission</strong></h3>

<p>As far as data transmission is concerned, Odil does not handle TCP/IP requests, but instead it manages connexion between remote devices through <strong>association</strong> negociation. An association is a network data exchange between a Service Class Provider or <strong>SCP</strong> and a Service Class User or <strong>SCU</strong>. </p>

<p><br> <br></p>



<div class="flow-chart"><svg style="overflow: hidden; position: relative; top: -0.116699px;" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="558" version="1.1" height="328"><desc>Created with Raphaël 2.1.2</desc><defs><marker refY="1.5" refX="1.5" orient="auto" markerWidth="3" markerHeight="3" id="raphael-marker-endblock33-obj240"><use stroke="none" fill="black" stroke-width="1.6667" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" xlink:href="#raphael-marker-block"></use></marker><marker refY="1.5" refX="1.5" orient="auto" markerWidth="3" markerHeight="3" id="raphael-marker-endblock33-obj241"><use stroke="none" fill="black" stroke-width="1.6667" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" xlink:href="#raphael-marker-block"></use></marker><marker refY="1.5" refX="1.5" orient="auto" markerWidth="3" markerHeight="3" id="raphael-marker-endblock33-obj242"><use stroke="none" fill="black" stroke-width="1.6667" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" xlink:href="#raphael-marker-block"></use></marker></defs><rect transform="matrix(1,0,0,1,211.5,4)" id="st" class="flowchart" stroke-width="2" style="" stroke="#000000" fill="#ffffff" ry="20" rx="20" height="40" width="137" y="0" x="0"></rect><text transform="matrix(1,0,0,1,211.5,4)" font-weight="normal" class="flowchartt" id="stt" fill="#000000" stroke="none" font-size="14px" font-family="sans-serif" text-anchor="start" y="20" x="10" style="text-anchor: start; font-family: sans-serif; font-size: 14px; font-weight: normal;"><tspan dy="5">TCP/IP networking</tspan></text><rect transform="matrix(1,0,0,1,4,98)" id="op" class="flowchart" stroke-width="2" style="" stroke="#000000" fill="#ffffff" ry="0" rx="0" height="40" width="552" y="0" x="0"></rect><text transform="matrix(1,0,0,1,4,98)" font-weight="normal" class="flowchartt" id="opt" fill="#000000" stroke="none" font-size="14px" font-family="sans-serif" text-anchor="start" y="20" x="10" style="text-anchor: start; font-family: sans-serif; font-size: 14px; font-weight: normal;"><tspan dy="5">Low-level DICOM :association negociation and PDU. Aka DICOM Upper Layer Protocol</tspan></text><rect transform="matrix(1,0,0,1,165,192)" id="op2" class="flowchart" stroke-width="2" style="" stroke="#000000" fill="#ffffff" ry="0" rx="0" height="40" width="230" y="0" x="0"></rect><text transform="matrix(1,0,0,1,165,192)" font-weight="normal" class="flowchartt" id="op2t" fill="#000000" stroke="none" font-size="14px" font-family="sans-serif" text-anchor="start" y="20" x="10" style="text-anchor: start; font-family: sans-serif; font-size: 14px; font-weight: normal;"><tspan dy="5">High-level DICOM DIMSE and SOP</tspan><tspan x="10" dy="18"></tspan></text><rect transform="matrix(1,0,0,1,181.5,286)" id="e" class="flowchart" stroke-width="2" style="" stroke="#000000" fill="#ffffff" ry="20" rx="20" height="40" width="197" y="0" x="0"></rect><text transform="matrix(1,0,0,1,181.5,286)" font-weight="normal" class="flowchartt" id="et" fill="#000000" stroke="none" font-size="14px" font-family="sans-serif" text-anchor="start" y="20" x="10" style="text-anchor: start; font-family: sans-serif; font-size: 14px; font-weight: normal;"><tspan dy="5">DICOM Software Application</tspan></text><path font-weight="normal" font-family="sans-serif" marker-end="url(#raphael-marker-endblock33-obj240)" stroke-width="2" d="M280,44C280,44,280,83.65409994125366,280,95.00043908460066" stroke="#000000" fill="none" style="font-family: sans-serif; font-weight: normal;"></path><path font-weight="normal" font-family="sans-serif" marker-end="url(#raphael-marker-endblock33-obj241)" stroke-width="2" d="M280,138C280,138,280,177.65409994125366,280,189.00043908460066" stroke="#000000" fill="none" style="font-family: sans-serif; font-weight: normal;"></path><path font-weight="normal" font-family="sans-serif" marker-end="url(#raphael-marker-endblock33-obj242)" stroke-width="2" d="M280,232C280,232,280,271.65409994125366,280,283.00043908460066" stroke="#000000" fill="none" style="font-family: sans-serif; font-weight: normal;"></path></svg></div>

<p><br></p>

<p>As you know, DICOM entities are identified by application and not by devices, so there is a need to give every application it’s own label to differenciate every single one of them. DICOM sets this parameter as the <strong>Application Entity Title</strong>. </p>

<p>Odil manages that in the <strong>AssociationParameters</strong>.  It is necessary to set a called AETitle and a calling AETitle.  <br>
Here’s an example of association parameter settings you can find in Odil’s examples: </p>

<pre><code>    association.update_parameters() 
    .set_calling_ae_title("myself")
    .set_called_ae_title("AWSPIXELMEDPUB")
</code></pre>

<p>The methods <em>set_calling_ae_title</em> and <em>set_called_ae_title</em> return the AssociationParameters after setting their respective attribute to the value you passed as argument to allow method chaining. </p>

<p>You can also create an association through the copy constructor, which will return an unassociated association with the same parameters as the old one you used to create your new association. You will then have to try to associate it via the odil::Association::associate() method. </p>

<p>To establish an association, you don’t only need to set AE’s identities, but you need to set the <strong>Presentation Contexts</strong> they are going to use to communicate. A presentation context (or PC)  lays down ground rules on the data transmission that will occur between the client (usually the calling AE) and the server (usually the called AE). This is how the communicating apps are going to negociate what parts of the standard they are going to share, and what they are going to communicate on. The information will be cut down between an essential (DICOM abstract syntax) and a negociable part (DICOM Transfer syntax).  DICOM offers many Abstract Syntax UIDs, which Odil implements in the odil::registry namespace. </p>

<p>So the first step of data transmission is the Association establishment, which goes this way: </p>



<h4 id="association-establishment"><strong>Association Establishment:</strong></h4>



<div class="sequence-diagram"><svg style="overflow: hidden; position: relative; top: -0.200195px;" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="1499.5" version="1.1" height="480"><desc>Created with Raphaël 2.1.2</desc><defs><path id="raphael-marker-block" d="M5,0 0,2.5 5,5z" stroke-linecap="round"></path><marker refY="2.5" refX="2.5" orient="auto" markerWidth="5" markerHeight="5" id="raphael-marker-endblock55-obj26"><use stroke="none" fill="#000" stroke-width="1.0000" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"></use></marker><marker refY="2.5" refX="2.5" orient="auto" markerWidth="5" markerHeight="5" id="raphael-marker-endblock55-obj29"><use stroke="none" fill="#000" stroke-width="1.0000" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"></use></marker><marker refY="2.5" refX="2.5" orient="auto" markerWidth="5" markerHeight="5" id="raphael-marker-endblock55-obj35"><use stroke="none" fill="#000" stroke-width="1.0000" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"></use></marker><marker refY="2.5" refX="2.5" orient="auto" markerWidth="5" markerHeight="5" id="raphael-marker-endblock55-obj41"><use stroke="none" fill="#000" stroke-width="1.0000" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"></use></marker><marker refY="2.5" refX="2.5" orient="auto" markerWidth="5" markerHeight="5" id="raphael-marker-endblock55-obj44"><use stroke="none" fill="#000" stroke-width="1.0000" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"></use></marker><marker refY="2.5" refX="2.5" orient="auto" markerWidth="5" markerHeight="5" id="raphael-marker-endblock55-obj47"><use stroke="none" fill="#000" stroke-width="1.0000" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"></use></marker></defs><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="40" width="84" y="20" x="281"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="64" y="30" x="291"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="40" x="323" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Calling AE</tspan></text><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="40" width="84" y="420" x="281"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="64" y="430" x="291"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="440" x="323" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Calling AE</tspan></text><path stroke-width="2" d="M323,60L323,420" stroke="#000000" fill="none" style=""></path><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="40" width="79" y="20" x="1164.5"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="59" y="30" x="1174.5"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="40" x="1204" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Called AE</tspan></text><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="40" width="79" y="420" x="1164.5"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="59" y="430" x="1174.5"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="440" x="1204" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Called AE</tspan></text><path stroke-width="2" d="M1204,60L1204,420" stroke="#000000" fill="none" style=""></path><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="249" y="75" x="639"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="85" x="763.5" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Hi, I'm Calling AE. Do you speak DICOM?</tspan></text><path stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55-obj26)" stroke-width="2" d="M323,100C323,100,1127.8585191369057,100,1198.99103474422,100" stroke="#000000" fill="none" style=""></path><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="159" y="115" x="684"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="125" x="763.5" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Hi, I'm Called AE. Yes I do.</tspan></text><path stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55-obj29)" stroke-width="2" d="M1204,140C1204,140,399.14148086309433,140,328.0089652557799,140" stroke="#000000" fill="none" style=""></path><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="30" width="283" y="160" x="20"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="273" y="165" x="25"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="175" x="161.5" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Make offer with abstract and transfer syntax</tspan></text><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="861" y="205" x="333"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="215" x="763.5" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">I have 92 new MR uncompressed images I want to send as is. I can also send them to you in JPEG2000 or compressed by 12-bit lossless JPEG.</tspan></text><path stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55-obj35)" stroke-width="2" d="M323,230C323,230,1127.8585191369057,230,1198.99103474422,230" stroke="#000000" fill="none" style=""></path><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="30" width="186" y="250" x="1224"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="176" y="255" x="1229"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="265" x="1317" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Agree on compatible syntax.</tspan></text><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="376" y="295" x="575.5"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="305" x="763.5" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">OK, I can take these images, but I prefer them uncompressed.</tspan></text><path stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55-obj41)" stroke-width="2" d="M1204,320C1204,320,399.14148086309433,320,328.0089652557799,320" stroke="#000000" fill="none" style=""></path><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="127" y="335" x="700"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="345" x="763.5" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">OK, starting to send.</tspan></text><path stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55-obj44)" stroke-width="2" d="M323,360C323,360,1127.8585191369057,360,1198.99103474422,360" stroke="#000000" fill="none" style=""></path><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="128" y="375" x="699.5"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="385" x="763.5" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">OK, ready to receive.</tspan></text><path stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55-obj47)" stroke-width="2" d="M1204,400C1204,400,399.14148086309433,400,328.0089652557799,400" stroke="#000000" fill="none" style=""></path></svg></div>

<p>According to <a href="http://dicomiseasy.blogspot.fr/2011/12/introduction-to-dicom-chapter-5-solving.html">DICOM is easy</a>, 99% of network problems you’ll encounter while working on DICOM networking, will occur during this A-ASSOCIATE-RQ step. If you want more information on DICOM’s way to implement A-ASSOCIATE-RQ , you can browse <a href="http://dicom.nema.org/medical/dicom/current/output/chtml/part08/sect_9.3.2.html">DICOM standard</a>. Odil stores the result of the presentation context negotiation directly inside of the Presentation Context ( <code>odil::AssociationParameters::PresentationContext</code>) , in this enum: </p>



<pre class="prettyprint"><code class=" hljs vala"><span class="hljs-keyword">enum</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Result</span>
        {</span>
            Acceptance = <span class="hljs-number">0</span>,
            UserRejection = <span class="hljs-number">1</span>,
            NoReason = <span class="hljs-number">2</span>,
            AbstractSyntaxNotSupported = <span class="hljs-number">3</span>,
            TransferSyntaxesNotSupported = <span class="hljs-number">4</span>,
        };</code></pre>

<p><br>
<br>
<br>
<br></p>



<h4 id="dicom-pdu-protocol-data-units"><strong>DICOM PDU (Protocol Data Units)</strong></h4>

<p>This diagram shows the main steps of DICOM communication between two Application Entities. </p>

<div class="sequence-diagram"><svg style="overflow: hidden; position: relative; top: -0.0834961px;" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="1008.5" version="1.1" height="710"><desc>Created with Raphaël 2.1.2</desc><defs><marker refY="2.5" refX="2.5" orient="auto" markerWidth="5" markerHeight="5" id="raphael-marker-endblock55-obj79"><use stroke="none" fill="#000" stroke-width="1.0000" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"></use></marker><path id="raphael-marker-open" d="M6,1 1,3.5 6,6" stroke-linecap="round"></path><marker refY="3.5" refX="4" orient="auto" markerWidth="7" markerHeight="7" id="raphael-marker-endopen77-obj88"><use stroke="#000" fill="none" stroke-width="1.0000" transform="rotate(180 3.5 3.5) scale(1,1)" xlink:href="#raphael-marker-open"></use></marker><marker refY="2.5" refX="2.5" orient="auto" markerWidth="5" markerHeight="5" id="raphael-marker-endblock55-obj91"><use stroke="none" fill="#000" stroke-width="1.0000" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"></use></marker><marker refY="2.5" refX="2.5" orient="auto" markerWidth="5" markerHeight="5" id="raphael-marker-endblock55-obj97"><use stroke="none" fill="#000" stroke-width="1.0000" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"></use></marker><marker refY="2.5" refX="2.5" orient="auto" markerWidth="5" markerHeight="5" id="raphael-marker-endblock55-obj103"><use stroke="none" fill="#000" stroke-width="1.0000" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"></use></marker><marker refY="3.5" refX="4" orient="auto" markerWidth="7" markerHeight="7" id="raphael-marker-endopen77-obj106"><use stroke="#000" fill="none" stroke-width="1.0000" transform="rotate(180 3.5 3.5) scale(1,1)" xlink:href="#raphael-marker-open"></use></marker><marker refY="2.5" refX="2.5" orient="auto" markerWidth="5" markerHeight="5" id="raphael-marker-endblock55-obj109"><use stroke="none" fill="#000" stroke-width="1.0000" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"></use></marker><marker refY="2.5" refX="2.5" orient="auto" markerWidth="5" markerHeight="5" id="raphael-marker-endblock55-obj115"><use stroke="none" fill="#000" stroke-width="1.0000" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"></use></marker></defs><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="40" width="84" y="20" x="158"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="64" y="30" x="168"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="40" x="200" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Calling AE</tspan></text><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="40" width="84" y="650" x="158"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="64" y="660" x="168"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="670" x="200" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Calling AE</tspan></text><path stroke-width="2" d="M200,60L200,650" stroke="#000000" fill="none" style=""></path><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="40" width="79" y="20" x="628.5"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="59" y="30" x="638.5"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="40" x="668" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Called AE</tspan></text><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="40" width="79" y="650" x="628.5"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="59" y="660" x="638.5"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="670" x="668" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Called AE</tspan></text><path stroke-width="2" d="M668,60L668,650" stroke="#000000" fill="none" style=""></path><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="245" y="75" x="311.5"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="85" x="434" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">A-ASSOCIATE-RQ (Request association)</tspan></text><path stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55-obj79)" stroke-width="2" d="M200,100C200,100,612.7218206524849,100,663.0021401118574,100" stroke="#000000" fill="none" style=""></path><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="30" width="160" y="120" x="20"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="150" y="125" x="25"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="135" x="100" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Handshake Negociation</tspan></text><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="30" width="81" y="170" x="688"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="71" y="175" x="693"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="185" x="728.5" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Supported?</tspan></text><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="414" y="215" x="227"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="225" x="434" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">A-ASSOCIATE-RJ( reject: AssociationRejected Exception is thrown )</tspan></text><path stroke-dasharray="6,2" marker-end="url(#raphael-marker-endopen77-obj88)" stroke-width="2" d="M668,240C668,240,235.1893699169159,240,202.01003938808572,240" stroke="#000000" fill="none" style=""></path><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="164" y="255" x="352"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="265" x="434" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">A-ASSOCIATE-AC(Success)</tspan></text><path stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55-obj91)" stroke-width="2" d="M668,280C668,280,255.2781793475151,280,204.99785988814256,280" stroke="#000000" fill="none" style=""></path><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="30" width="150" y="300" x="30"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="140" y="305" x="35"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="315" x="105" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Begin transfering Data</tspan></text><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="66" y="345" x="401.5"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="355" x="434" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">P-DATA-TF</tspan></text><path stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55-obj97)" stroke-width="2" d="M200,370C200,370,612.7218206524849,370,663.0021401118574,370" stroke="#000000" fill="none" style=""></path><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="30" width="227" y="390" x="688"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="217" y="395" x="693"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="405" x="801.5" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Perform data treatment operations</tspan></text><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="66" y="435" x="401.5"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="445" x="434" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">P-DATA-TF</tspan></text><path stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55-obj103)" stroke-width="2" d="M200,460C200,460,612.7218206524849,460,663.0021401118574,460" stroke="#000000" fill="none" style=""></path><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="448" y="475" x="210"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="485" x="434" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">A-Abort ( anything goes wrong: AssociationAborted Exception is thrown)</tspan></text><path stroke-dasharray="6,2" marker-end="url(#raphael-marker-endopen77-obj106)" stroke-width="2" d="M668,500C668,500,235.1893699169159,500,202.01003938808572,500" stroke="#000000" fill="none" style=""></path><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="97" y="515" x="385.5"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="525" x="434" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">A-RELEASE-RQ.</tspan></text><path stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55-obj109)" stroke-width="2" d="M200,540C200,540,612.7218206524849,540,663.0021401118574,540" stroke="#000000" fill="none" style=""></path><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="30" width="231" y="560" x="688"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="221" y="565" x="693"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="575" x="803.5" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">End transaction (Close association)</tspan></text><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="94" y="605" x="387"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="615" x="434" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">A-RELEASE-RP.</tspan></text><path stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55-obj115)" stroke-width="2" d="M668,630C668,630,255.2781793475151,630,204.99785988814256,630" stroke="#000000" fill="none" style=""></path></svg></div>

<p>On this Diagram(above), dashed lines show failures in the process, for which Odil will throw an error.  <br>
For each of those steps, the AEs will be in a different state. Should you need it, you can find more information about those states <a href="http://dicom.nema.org/dicom/2013/output/chtml/part08/sect_9.2.html">here</a>. </p>

<p>Here is Odil’s implementation of them in odil::dul::StateMachine::State: </p>

<pre><code> enum class State
    {
        Sta1,
        Sta2, Sta3, Sta4, Sta5,
        Sta6,
        Sta7, Sta8, Sta9, Sta10, Sta11, Sta12,
        Sta13
    };
</code></pre>



<h3 id="6-protocols">6. Protocols</h3>

<p>Most of DICOM communication is made through messages, which Odil implements in the odil::message namespace.  <br>
As you can see in the diagrams contained in this documentation, most messages can be split into two categories: requests and responses hence Odil chose to implement messages through inheritance of a Request or a Response base class.  </p>

<p><img src="https://owncloud.u-strasbg.fr/index.php/apps/files_sharing/ajax/publicpreview.php?x=1920&amp;y=575&amp;a=true&amp;file=Odil_message_inheritance.png&amp;t=9tjPT1zDRPfUBbz&amp;scalingup=0.png" alt="Image inheritance" title=""> <br>
<br><br><br>
In the same way, odil implements SCUs and SCPs for every type of protocol below. Each and everyone of them inherits the base class SCU or SCP.  </p>



<h4 id="echo">echo</h4>

<p>C-Echo has been nicknamed “DICOM ping”, because using a TCP ping only gives us informations about the TCP connection between two devices, but does not tell us if the distant machine is running any DICOM software at all. C-Echo uses DICOM procedures, and then gives us the information </p>



<div class="sequence-diagram"><svg style="overflow: hidden; position: relative; top: -0.366699px;" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="577.5" version="1.1" height="220"><desc>Created with Raphaël 2.1.2</desc><defs><marker refY="2.5" refX="2.5" orient="auto" markerWidth="5" markerHeight="5" id="raphael-marker-endblock55-obj136"><use stroke="none" fill="#000" stroke-width="1.0000" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"></use></marker><marker refY="2.5" refX="2.5" orient="auto" markerWidth="5" markerHeight="5" id="raphael-marker-endblock55-obj139"><use stroke="none" fill="#000" stroke-width="1.0000" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"></use></marker></defs><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="40" width="180" y="20" x="10"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="160" y="30" x="20"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="40" x="100" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Requesting AE (EchoSCU)</tspan></text><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="40" width="180" y="160" x="10"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="160" y="170" x="20"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="180" x="100" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Requesting AE (EchoSCU)</tspan></text><path stroke-width="2" d="M100,60L100,160" stroke="#000000" fill="none" style=""></path><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="40" width="183" y="20" x="364.5"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="163" y="30" x="374.5"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="40" x="456" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Responding AE (EchoSCP)</tspan></text><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="40" width="183" y="160" x="364.5"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="163" y="170" x="374.5"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="180" x="456" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Responding AE (EchoSCP)</tspan></text><path stroke-width="2" d="M456,60L456,160" stroke="#000000" fill="none" style=""></path><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="321" y="75" x="117.5"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="85" x="278" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">CEchoRequest: Odil's implementation of C-Echo-Rq</tspan></text><path stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55-obj136)" stroke-width="2" d="M100,100C100,100,407.8591368198395,100,451.0015060909791,100" stroke="#000000" fill="none" style=""></path><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="336" y="115" x="110"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="125" x="278" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">CEchoResponse: Odil's implementation of C-Echo-Rsp</tspan></text><path stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55-obj139)" stroke-width="2" d="M456,140C456,140,148.14086318016052,140,104.99849390902091,140" stroke="#000000" fill="none" style=""></path></svg></div>

<pre><code>class CEchoRequest: public Request
class CEchoResponse: public Response
class EchoSCU: public SCU
class EchoSCP: public SCP
</code></pre>



<h4 id="store">store</h4>

<p>DIMSE services dealing with composite data are called “DIMSE-C” services; and DIMSE services dealing with normalized data are called “DIMSE-N” services. The “C” and “N” are often prefixed to the service name; for ex­ample, the C-Store service stores DICOM images (composite objects). Similarly, <br>
DIMSE messages with service requests are labeled with an “Rq” suffix (e.g., C-Store-Rq is what a CT scanner sends to a digital archive, requesting image storage). DIMSE messages with service responses are labeled with an “Rsp” suffix (e.g., C-Store-Rsp is used by an archive to reply to the scanner).</p>

<p>In Odil, you need to instanciate the Store SCU by providing an association between the AEs and  <br>
SCP by providing an association, and eventually a callback, which will be used to treat the requests it will receive and then send a C-Store-Response under the form of a <code>odil::message::CStoreResponse</code>. </p>



<h4 id="find">find</h4>

<p>In a way, C-Find is  similar to C-Echo, with the SCU (or calling AE) sending a request to the SCP(or called AE), which treats it before sending a response. </p>

<p>Odil allows you to instanciate a FindSCP or FindSCU to handle C-Find based operations. Both can be instanciated from the association linking the calling AE and the called AE and an optional parameter.  <br>
The optional parameter for the FindSCU is the callback which will be used by  the FindSCU object throught the method <code>::odil::FindSCU::find( Dataset&amp;, Callback)</code>. </p>

<p>You can find an example of how to use a FindSCU <a href="https://github.com/lamyj/odil/blob/master/examples/find.cpp">in odil’s find example.</a></p>



<h4 id="get">get</h4>

<p>C-GET Protocol allows you to fetch and select  </p>



<div class="sequence-diagram"><svg style="overflow: hidden; position: relative; top: -0.299805px;" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="216.5" version="1.1" height="250"><desc>Created with Raphaël 2.1.2</desc><defs><marker refY="2.5" refX="2.5" orient="auto" markerWidth="5" markerHeight="5" id="raphael-marker-endblock55-obj164"><use stroke="none" fill="#000" stroke-width="1.0000" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"></use></marker><marker refY="2.5" refX="2.5" orient="auto" markerWidth="5" markerHeight="5" id="raphael-marker-endblock55-obj167"><use stroke="none" fill="#000" stroke-width="1.0000" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"></use></marker></defs><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="30" width="168" y="10" x="10"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="158" y="15" x="15"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="25" x="94" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">C-GET Sequence diagram</tspan></text><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="40" width="67" y="50" x="10"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="47" y="60" x="20"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="70" x="43.5" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">GetSCP</tspan></text><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="40" width="67" y="190" x="10"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="47" y="200" x="20"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="210" x="43.5" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">GetSCP</tspan></text><path stroke-width="2" d="M43.5,90L43.5,190" stroke="#000000" fill="none" style=""></path><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="40" width="68" y="50" x="118.5"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="48" y="60" x="128.5"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="70" x="152.5" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">GetSCU</tspan></text><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="40" width="68" y="190" x="118.5"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="48" y="200" x="128.5"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="210" x="152.5" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">GetSCU</tspan></text><path stroke-width="2" d="M152.5,90L152.5,190" stroke="#000000" fill="none" style=""></path><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="80" y="105" x="58"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="115" x="98" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">CGetRequest</tspan></text><path stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55-obj164)" stroke-width="2" d="M43.5,130C43.5,130,126.11697316169739,130,147.49734219280072,130" stroke="#000000" fill="none" style=""></path><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="89" y="145" x="53.5"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="155" x="98" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">CGetResponse</tspan></text><path stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55-obj167)" stroke-width="2" d="M152.5,170C152.5,170,69.88302683830261,170,48.502657807199284,170" stroke="#000000" fill="none" style=""></path></svg></div>

<p>You can find an example of how to use a GetSCU <a href="https://github.com/lamyj/odil/blob/master/examples/get.cpp">in odil’s GET example.</a> <br>
More info about <a href="http://dicom.nema.org/medical/dicom/current/output/chtml/part04/sect_C.4.3.html#table_C.4-3">C-GET Response Status codes:</a></p>



<h4 id="move">move</h4>

<p>The move protocol is a protocol during which the calling AE (<code>::odil::MoveSCU</code>) queries the SCP (<code>::odil::MoveSCP</code>) to send it all the images matching the metadata defined in the <code>::odil::message::CMoveRequest</code>.  The query can be done at different levels, which can be one of the following coded strings: PATIENT, STUDY, SERIES or IMAGE. </p>



<div class="sequence-diagram"><svg style="overflow: hidden; position: relative; top: -0.299805px;" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="933.5" version="1.1" height="300"><desc>Created with Raphaël 2.1.2</desc><defs><marker refY="2.5" refX="2.5" orient="auto" markerWidth="5" markerHeight="5" id="raphael-marker-endblock55-obj190"><use stroke="none" fill="#000" stroke-width="1.0000" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"></use></marker><marker refY="2.5" refX="2.5" orient="auto" markerWidth="5" markerHeight="5" id="raphael-marker-endblock55-obj195"><use stroke="none" fill="#000" stroke-width="1.0000" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"></use></marker><marker refY="2.5" refX="2.5" orient="auto" markerWidth="5" markerHeight="5" id="raphael-marker-endblock55-obj198"><use stroke="none" fill="#000" stroke-width="1.0000" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"></use></marker><marker refY="2.5" refX="2.5" orient="auto" markerWidth="5" markerHeight="5" id="raphael-marker-endblock55-obj203"><use stroke="none" fill="#000" stroke-width="1.0000" transform="rotate(180 2.5 2.5) scale(1,1)" xlink:href="#raphael-marker-block"></use></marker></defs><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="40" width="80" y="20" x="10"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="60" y="30" x="20"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="40" x="50" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">MoveSCU</tspan></text><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="40" width="80" y="240" x="10"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="60" y="250" x="20"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="260" x="50" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">MoveSCU</tspan></text><path stroke-width="2" d="M50,60L50,240" stroke="#000000" fill="none" style=""></path><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="40" width="79" y="20" x="564.5"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="59" y="30" x="574.5"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="40" x="604" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">MoveSCP</tspan></text><rect stroke-width="2" style="" stroke="#000000" fill="none" ry="0" rx="0" height="40" width="79" y="240" x="564.5"></rect><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="59" y="250" x="574.5"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="260" x="604" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">MoveSCP</tspan></text><path stroke-width="2" d="M604,60L604,240" stroke="#000000" fill="none" style=""></path><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="534" y="75" x="60"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="85" x="327" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Send me all the images there the Patient name is Odil* (odil::message::CMoveRequest)</tspan></text><path stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55-obj190)" stroke-width="2" d="M50,100C50,100,543.7853637933731,100,598.998668631597,100" stroke="#000000" fill="none" style=""></path><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="220" y="120" x="629"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="130" x="739" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Generate DataSet matching criteria</tspan></text><path stroke-dasharray="0" stroke-width="2" d="M604,115L624,115" stroke="#000000" fill="none" style=""></path><path stroke-dasharray="0" stroke-width="2" d="M624,115L624,150" stroke="#000000" fill="none" style=""></path><path marker-end="url(#raphael-marker-endblock55-obj195)" stroke-dasharray="0" stroke-width="2" d="M624,150C624,150,614.9191131591797,150,608.9952533841133,150" stroke="#000000" fill="none" style=""></path><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="459" y="155" x="97.5"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="165" x="327" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Here you go, that's all the images I have. (odil::message::CMoveResponse)</tspan></text><path stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55-obj198)" stroke-width="2" d="M604,180C604,180,110.21463620662689,180,55.001331368403044,180" stroke="#000000" fill="none" style=""></path><rect style="" stroke="none" fill="#ffffff" ry="0" rx="0" height="20" width="163" y="200" x="75"></rect><text fill="#000000" stroke="none" font-size="16px" font-family="Andale Mono, monospace" text-anchor="middle" y="210" x="156.5" style="text-anchor: middle; font-family: Andale Mono,monospace; font-size: 16px;"><tspan dy="5">Store the images received.</tspan></text><path stroke-dasharray="0" stroke-width="2" d="M50,195L70,195" stroke="#000000" fill="none" style=""></path><path stroke-dasharray="0" stroke-width="2" d="M70,195L70,230" stroke="#000000" fill="none" style=""></path><path marker-end="url(#raphael-marker-endblock55-obj203)" stroke-dasharray="0" stroke-width="2" d="M70,230C70,230,60.91911315917969,230,54.99525338411331,230" stroke="#000000" fill="none" style=""></path></svg></div>

<p>You can find an example of how to use a MoveSCU <a href="https://github.com/lamyj/odil/blob/master/examples/move.cpp">in odil’s move example.</a></p></div></body>
</html>
